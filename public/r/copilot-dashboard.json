{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "copilot-dashboard",
  "type": "registry:component",
  "title": "CopilotDashboard",
  "description": "Metrics dashboard with AI-generated insights and anomaly detection.",
  "dependencies": [
    "@copilotkit/react-core",
    "lucide-react"
  ],
  "registryDependencies": [],
  "files": [
    {
      "path": "registry/copilot-dashboard.tsx",
      "content": "\"use client\";\n\nimport { useState, useCallback, useRef, useMemo } from \"react\";\nimport { useCopilotReadable, useCopilotAction } from \"@copilotkit/react-core\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  TrendingUp,\n  TrendingDown,\n  Loader2,\n  Sparkles,\n  CheckCircle,\n} from \"lucide-react\";\n\nexport interface DashboardMetric {\n  id: string;\n  title: string;\n  value: string;\n  change: string;\n  changeType: \"positive\" | \"negative\";\n  sparklineData: number[];\n}\n\ninterface CopilotDashboardProps {\n  metrics?: DashboardMetric[];\n  className?: string;\n}\n\nconst defaultMetrics: DashboardMetric[] = [\n  {\n    id: \"mrr\",\n    title: \"MRR\",\n    value: \"$48.5k\",\n    change: \"+12%\",\n    changeType: \"positive\",\n    sparklineData: [30, 35, 32, 40, 38, 45, 42, 48],\n  },\n  {\n    id: \"churn-rate\",\n    title: \"Churn Rate\",\n    value: \"2.1%\",\n    change: \"-0.3%\",\n    changeType: \"positive\",\n    sparklineData: [3.2, 3.0, 2.8, 2.9, 2.5, 2.4, 2.2, 2.1],\n  },\n  {\n    id: \"nps-score\",\n    title: \"NPS Score\",\n    value: \"72\",\n    change: \"+5\",\n    changeType: \"positive\",\n    sparklineData: [58, 60, 62, 65, 64, 68, 70, 72],\n  },\n  {\n    id: \"active-users\",\n    title: \"Active Users\",\n    value: \"1,234\",\n    change: \"+8%\",\n    changeType: \"positive\",\n    sparklineData: [980, 1020, 1050, 1080, 1100, 1150, 1200, 1234],\n  },\n  {\n    id: \"revenue\",\n    title: \"Revenue\",\n    value: \"$142k\",\n    change: \"+15%\",\n    changeType: \"positive\",\n    sparklineData: [95, 100, 108, 115, 120, 128, 135, 142],\n  },\n  {\n    id: \"avg-ticket\",\n    title: \"Avg Ticket\",\n    value: \"$38\",\n    change: \"+2%\",\n    changeType: \"positive\",\n    sparklineData: [32, 33, 34, 35, 34, 36, 37, 38],\n  },\n];\n\ntype DateRange = \"7d\" | \"30d\" | \"90d\" | \"1y\";\n\nfunction Sparkline({\n  data,\n  color,\n  width = 80,\n  height = 32,\n}: {\n  data: number[];\n  color: string;\n  width?: number;\n  height?: number;\n}) {\n  if (data.length < 2) return null;\n\n  const min = Math.min(...data);\n  const max = Math.max(...data);\n  const range = max - min || 1;\n\n  const points = data\n    .map((value, index) => {\n      const x = (index / (data.length - 1)) * width;\n      const y = height - ((value - min) / range) * (height - 4) - 2;\n      return `${x},${y}`;\n    })\n    .join(\" \");\n\n  return (\n    <svg\n      width={width}\n      height={height}\n      viewBox={`0 0 ${width} ${height}`}\n      fill=\"none\"\n      className=\"overflow-visible\"\n    >\n      <polyline\n        points={points}\n        fill=\"none\"\n        stroke={color}\n        strokeWidth={1.5}\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </svg>\n  );\n}\n\nexport function CopilotDashboard({\n  metrics: propMetrics,\n  className,\n}: CopilotDashboardProps) {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [metrics, setMetrics] = useState<DashboardMetric[]>(\n    propMetrics ?? defaultMetrics\n  );\n  const [dateRange, setDateRange] = useState<DateRange>(\"30d\");\n  const [highlightedMetrics, setHighlightedMetrics] = useState<Set<string>>(\n    new Set()\n  );\n  const [insight, setInsight] = useState<string | null>(null);\n  const [comparisonResult, setComparisonResult] = useState<string | null>(null);\n  const highlightTimeouts = useRef<Map<string, ReturnType<typeof setTimeout>>>(\n    new Map()\n  );\n\n  const triggerHighlight = useCallback((metricId: string) => {\n    const existing = highlightTimeouts.current.get(metricId);\n    if (existing) clearTimeout(existing);\n\n    setHighlightedMetrics((prev) => new Set(prev).add(metricId));\n    const timeout = setTimeout(() => {\n      setHighlightedMetrics((prev) => {\n        const next = new Set(prev);\n        next.delete(metricId);\n        return next;\n      });\n      highlightTimeouts.current.delete(metricId);\n    }, 1500);\n    highlightTimeouts.current.set(metricId, timeout);\n  }, []);\n\n  const dateRangeOptions: DateRange[] = useMemo(\n    () => [\"7d\", \"30d\", \"90d\", \"1y\"],\n    []\n  );\n\n  // Expose dashboard state to AI\n  useCopilotReadable({\n    description:\n      \"Current metrics dashboard state including all KPI metrics, active date range, and any AI-generated insights\",\n    value: {\n      dateRange,\n      metrics: metrics.map((m) => ({\n        id: m.id,\n        title: m.title,\n        value: m.value,\n        change: m.change,\n        changeType: m.changeType,\n      })),\n      highlightedMetrics: Array.from(highlightedMetrics),\n      currentInsight: insight,\n      comparisonResult,\n    },\n  });\n\n  // AI action: filter by date range\n  useCopilotAction({\n    name: \"filterByDateRange\",\n    description:\n      \"Change the dashboard date range filter. Available ranges: 7d, 30d, 90d, 1y\",\n    parameters: [\n      {\n        name: \"range\",\n        type: \"string\",\n        description:\n          'The date range to filter by: \"7d\", \"30d\", \"90d\", or \"1y\"',\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-blue-400\" />\n            <span>Changing date range...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-blue-500/30 bg-blue-500/10 px-3 py-2 text-sm text-blue-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>\n            Date range set to <strong>{args.range}</strong>\n          </span>\n        </div>\n      );\n    },\n    handler: ({ range }) => {\n      const validRanges: DateRange[] = [\"7d\", \"30d\", \"90d\", \"1y\"];\n      if (!validRanges.includes(range as DateRange)) {\n        return `Invalid range \"${range}\". Use one of: 7d, 30d, 90d, 1y`;\n      }\n      setDateRange(range as DateRange);\n      return `Date range updated to ${range}`;\n    },\n  });\n\n  // AI action: highlight a metric\n  useCopilotAction({\n    name: \"highlightMetric\",\n    description:\n      \"Highlight a specific metric card to draw attention to it with a violet glow animation\",\n    parameters: [\n      {\n        name: \"metricId\",\n        type: \"string\",\n        description: `The ID of the metric to highlight. Available: ${metrics.map((m) => m.id).join(\", \")}`,\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-violet-400\" />\n            <span>Highlighting metric...</span>\n          </div>\n        );\n      }\n      const metric = metrics.find((m) => m.id === args.metricId);\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-violet-500/30 bg-violet-500/10 px-3 py-2 text-sm text-violet-400\">\n          <Sparkles className=\"h-4 w-4\" />\n          <span>\n            Highlighted <strong>{metric?.title ?? args.metricId}</strong>\n          </span>\n        </div>\n      );\n    },\n    handler: ({ metricId }) => {\n      const metric = metrics.find((m) => m.id === metricId);\n      if (!metric) return `Metric \"${metricId}\" not found`;\n      triggerHighlight(metricId);\n      return `Highlighted metric: ${metric.title}`;\n    },\n  });\n\n  // AI action: compare metrics\n  useCopilotAction({\n    name: \"compareMetrics\",\n    description:\n      \"Compare two metrics side by side and display a summary of their differences\",\n    parameters: [\n      {\n        name: \"metricIdA\",\n        type: \"string\",\n        description: `The ID of the first metric. Available: ${metrics.map((m) => m.id).join(\", \")}`,\n        required: true,\n      },\n      {\n        name: \"metricIdB\",\n        type: \"string\",\n        description: `The ID of the second metric. Available: ${metrics.map((m) => m.id).join(\", \")}`,\n        required: true,\n      },\n      {\n        name: \"summary\",\n        type: \"string\",\n        description: \"A brief AI-generated comparison summary of the two metrics\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-amber-400\" />\n            <span>Comparing metrics...</span>\n          </div>\n        );\n      }\n      const metricA = metrics.find((m) => m.id === args.metricIdA);\n      const metricB = metrics.find((m) => m.id === args.metricIdB);\n      return (\n        <div className=\"rounded-lg border border-amber-500/30 bg-amber-500/10 px-3 py-2 text-sm text-amber-400\">\n          <div className=\"flex items-center gap-2\">\n            <CheckCircle className=\"h-4 w-4\" />\n            <span>\n              Compared <strong>{metricA?.title ?? args.metricIdA}</strong> vs{\" \"}\n              <strong>{metricB?.title ?? args.metricIdB}</strong>\n            </span>\n          </div>\n          {args.summary && (\n            <p className=\"mt-1 text-xs text-amber-400/70\">{args.summary}</p>\n          )}\n        </div>\n      );\n    },\n    handler: ({ metricIdA, metricIdB, summary }) => {\n      const metricA = metrics.find((m) => m.id === metricIdA);\n      const metricB = metrics.find((m) => m.id === metricIdB);\n      if (!metricA) return `Metric \"${metricIdA}\" not found`;\n      if (!metricB) return `Metric \"${metricIdB}\" not found`;\n\n      triggerHighlight(metricIdA);\n      triggerHighlight(metricIdB);\n\n      const result =\n        summary ||\n        `${metricA.title} (${metricA.value}, ${metricA.change}) vs ${metricB.title} (${metricB.value}, ${metricB.change})`;\n      setComparisonResult(result);\n      return result;\n    },\n  });\n\n  // AI action: generate insight\n  useCopilotAction({\n    name: \"generateInsight\",\n    description:\n      \"Generate and display an AI insight card below the metrics based on the current dashboard data\",\n    parameters: [\n      {\n        name: \"insight\",\n        type: \"string\",\n        description:\n          \"The AI-generated insight text to display on the dashboard\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-emerald-400\" />\n            <span>Generating insight...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"rounded-lg border border-emerald-500/30 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-400\">\n          <div className=\"flex items-center gap-2\">\n            <Sparkles className=\"h-4 w-4\" />\n            <span>Insight added to dashboard</span>\n          </div>\n          {args.insight && (\n            <p className=\"mt-1 text-xs text-emerald-400/70 truncate\">\n              {args.insight}\n            </p>\n          )}\n        </div>\n      );\n    },\n    handler: ({ insight: insightText }) => {\n      setInsight(insightText);\n      return `Insight displayed: ${insightText}`;\n    },\n  });\n\n  return (\n    <div className={cn(\"w-full space-y-4\", className)}>\n      {/* Date range filter */}\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-lg font-semibold text-foreground\">\n          Metrics Dashboard\n        </h2>\n        <div className=\"flex items-center gap-1 rounded-lg border border-border/50 bg-card/50 p-1\">\n          {dateRangeOptions.map((range) => (\n            <button\n              key={range}\n              onClick={() => setDateRange(range)}\n              className={cn(\n                \"rounded-md px-3 py-1.5 text-xs font-medium transition-colors\",\n                dateRange === range\n                  ? \"bg-foreground text-background shadow-sm\"\n                  : \"text-muted-foreground hover:text-foreground\"\n              )}\n            >\n              {range}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Metrics grid */}\n      <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n        {metrics.map((metric) => {\n          const isHighlighted = highlightedMetrics.has(metric.id);\n          return (\n            <div\n              key={metric.id}\n              className={cn(\n                \"rounded-xl border border-border/50 bg-card/50 p-4 backdrop-blur-sm transition-all duration-300\",\n                isHighlighted &&\n                  \"animate-[highlight-glow_1.5s_ease-in-out] border-violet-500/60 shadow-[0_0_16px_rgba(139,92,246,0.35)]\"\n              )}\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-xs font-medium text-muted-foreground\">\n                    {metric.title}\n                  </p>\n                  <p className=\"text-2xl font-bold tracking-tight text-foreground\">\n                    {metric.value}\n                  </p>\n                </div>\n                <Sparkline\n                  data={metric.sparklineData}\n                  color={\n                    metric.changeType === \"positive\"\n                      ? \"rgb(34, 197, 94)\"\n                      : \"rgb(239, 68, 68)\"\n                  }\n                />\n              </div>\n              <div className=\"mt-3 flex items-center gap-1.5\">\n                {metric.changeType === \"positive\" ? (\n                  <TrendingUp className=\"h-3.5 w-3.5 text-emerald-500\" />\n                ) : (\n                  <TrendingDown className=\"h-3.5 w-3.5 text-red-500\" />\n                )}\n                <span\n                  className={cn(\n                    \"text-xs font-medium\",\n                    metric.changeType === \"positive\"\n                      ? \"text-emerald-500\"\n                      : \"text-red-500\"\n                  )}\n                >\n                  {metric.change}\n                </span>\n                <span className=\"text-xs text-muted-foreground\">\n                  vs prev. period\n                </span>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Comparison result */}\n      {comparisonResult && (\n        <div className=\"rounded-xl border border-amber-500/30 bg-amber-500/5 p-4\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"flex size-8 shrink-0 items-center justify-center rounded-lg bg-amber-500/10\">\n              <TrendingUp className=\"h-4 w-4 text-amber-400\" />\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-foreground\">\n                Metric Comparison\n              </p>\n              <p className=\"mt-1 text-sm leading-relaxed text-muted-foreground\">\n                {comparisonResult}\n              </p>\n            </div>\n            <button\n              onClick={() => setComparisonResult(null)}\n              className=\"ml-auto shrink-0 text-xs text-muted-foreground hover:text-foreground transition-colors\"\n            >\n              Dismiss\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* AI Insight card */}\n      {insight && (\n        <div className=\"rounded-xl border border-violet-500/30 bg-violet-500/5 p-4\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"flex size-8 shrink-0 items-center justify-center rounded-lg bg-violet-500/10\">\n              <Sparkles className=\"h-4 w-4 text-violet-400\" />\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-foreground\">AI Insight</p>\n              <p className=\"mt-1 text-sm leading-relaxed text-muted-foreground\">\n                {insight}\n              </p>\n            </div>\n            <button\n              onClick={() => setInsight(null)}\n              className=\"ml-auto shrink-0 text-xs text-muted-foreground hover:text-foreground transition-colors\"\n            >\n              Dismiss\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Screen reader live region */}\n      <div aria-live=\"polite\" className=\"sr-only\">\n        Dashboard showing {metrics.length} metrics for {dateRange} period\n        {insight ? `. Insight: ${insight}` : \"\"}\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    }
  ]
}