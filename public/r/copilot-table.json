{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "copilot-table",
  "type": "registry:component",
  "title": "CopilotTable",
  "description": "A smart data grid that lets users sort, filter, and analyze data through natural language.",
  "dependencies": [
    "@copilotkit/react-core",
    "lucide-react"
  ],
  "registryDependencies": [],
  "docs": "## Setup\n\n### 1. Install CopilotKit dependencies\n\n```bash\nnpm install @copilotkit/react-core @copilotkit/react-ui @copilotkit/runtime\n```\n\n### 2. Create an API route\n\nCreate `app/api/copilotkit/route.ts`:\n\n```ts\nimport {\n  CopilotRuntime,\n  OpenAIAdapter,\n  copilotRuntimeNextJSAppRouterEndpoint,\n} from \"@copilotkit/runtime\";\n\nexport const maxDuration = 60;\n\nconst runtime = new CopilotRuntime();\nconst serviceAdapter = new OpenAIAdapter();\n\nconst { handleRequest } = copilotRuntimeNextJSAppRouterEndpoint({\n  runtime,\n  serviceAdapter,\n  endpoint: \"/api/copilotkit\",\n});\n\nexport { handleRequest as POST };\n```\n\n### 3. Environment variables\n\nAdd to `.env.local`:\n\n```\nOPENAI_API_KEY=sk-...\n```\n\n### 4. Wrap your app with CopilotKit\n\nIn your page or layout, wrap the component tree with the CopilotKit provider and add a chat UI:\n\n```tsx\n\"use client\";\nimport { CopilotKit } from \"@copilotkit/react-core\";\nimport { CopilotPopup } from \"@copilotkit/react-ui\";\nimport \"@copilotkit/react-ui/styles.css\";\n\nexport default function Page() {\n  return (\n    <CopilotKit runtimeUrl=\"/api/copilotkit\">\n      {/* your components here */}\n      <CopilotPopup />\n    </CopilotKit>\n  );\n}\n```\n\n## Usage\n\n```tsx\nimport { CopilotTable, ColumnDef } from \"@/components/copilot-table\";\n\ninterface Row {\n  [key: string]: unknown;\n  name: string;\n  role: string;\n  salary: number;\n}\n\nconst data: Row[] = [\n  { name: \"Alice\", role: \"Engineer\", salary: 120000 },\n  { name: \"Bob\", role: \"Designer\", salary: 95000 },\n];\n\nconst columns: ColumnDef<Row>[] = [\n  { key: \"name\", label: \"Name\" },\n  { key: \"role\", label: \"Role\" },\n  { key: \"salary\", label: \"Salary\" },\n];\n\n<CopilotTable data={data} columns={columns} />\n```\n\nThe AI can sort, filter, and highlight rows via the chat popup.",
  "files": [
    {
      "path": "registry/copilot-table.tsx",
      "content": "\"use client\";\n\nimport { useState, useMemo, useCallback } from \"react\";\nimport { useCopilotReadable, useCopilotAction } from \"@copilotkit/react-core\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  ArrowUpDown,\n  ArrowUp,\n  ArrowDown,\n  X,\n  Search,\n  Filter,\n  Sparkles,\n} from \"lucide-react\";\n\ntype AnyRow = Record<string, unknown>;\n\nexport interface ColumnDef<T = AnyRow> {\n  key: keyof T & string;\n  label: string;\n  sortable?: boolean;\n  filterable?: boolean;\n  render?: (value: T[keyof T], row: T) => React.ReactNode;\n}\n\ninterface SortState {\n  columnKey: string;\n  direction: \"asc\" | \"desc\";\n}\n\ninterface FilterState {\n  columnKey: string;\n  value: string;\n  operator: \"contains\" | \"equals\" | \"gt\" | \"lt\" | \"gte\" | \"lte\";\n}\n\ninterface CopilotTableProps<T = AnyRow> {\n  data: T[];\n  columns: ColumnDef<T>[];\n  className?: string;\n}\n\nexport function CopilotTable<T extends AnyRow>({\n  data,\n  columns,\n  className,\n}: CopilotTableProps<T>) {\n  const [sort, setSort] = useState<SortState | null>(null);\n  const [filters, setFilters] = useState<Record<string, string>>({});\n  const [activeFilters, setActiveFilters] = useState<FilterState[]>([]);\n  const [highlightedRows, setHighlightedRows] = useState<number[]>([]);\n\n  const applyFilter = useCallback(\n    (row: T, filter: FilterState): boolean => {\n      const rawValue = row[filter.columnKey as keyof T];\n      const cellValue = String(rawValue ?? \"\").toLowerCase();\n      const filterValue = filter.value.toLowerCase();\n\n      switch (filter.operator) {\n        case \"contains\":\n          return cellValue.includes(filterValue);\n        case \"equals\":\n          return cellValue === filterValue;\n        case \"gt\":\n          return parseFloat(cellValue) > parseFloat(filterValue);\n        case \"lt\":\n          return parseFloat(cellValue) < parseFloat(filterValue);\n        case \"gte\":\n          return parseFloat(cellValue) >= parseFloat(filterValue);\n        case \"lte\":\n          return parseFloat(cellValue) <= parseFloat(filterValue);\n        default:\n          return true;\n      }\n    },\n    []\n  );\n\n  const filteredAndSortedData = useMemo(() => {\n    let result = [...data];\n\n    // Apply inline text filters\n    for (const [key, value] of Object.entries(filters)) {\n      if (value.trim()) {\n        result = result.filter((row) =>\n          String(row[key as keyof T] ?? \"\")\n            .toLowerCase()\n            .includes(value.toLowerCase())\n        );\n      }\n    }\n\n    // Apply AI-driven filters\n    for (const filter of activeFilters) {\n      result = result.filter((row) => applyFilter(row, filter));\n    }\n\n    // Apply sort\n    if (sort) {\n      result.sort((a, b) => {\n        const aVal = a[sort.columnKey as keyof T];\n        const bVal = b[sort.columnKey as keyof T];\n        const aStr = String(aVal ?? \"\");\n        const bStr = String(bVal ?? \"\");\n        const aNum = parseFloat(aStr);\n        const bNum = parseFloat(bStr);\n\n        if (!isNaN(aNum) && !isNaN(bNum)) {\n          return sort.direction === \"asc\" ? aNum - bNum : bNum - aNum;\n        }\n        return sort.direction === \"asc\"\n          ? aStr.localeCompare(bStr)\n          : bStr.localeCompare(aStr);\n      });\n    }\n\n    return result;\n  }, [data, filters, activeFilters, sort, applyFilter]);\n\n  // Expose table state to AI\n  useCopilotReadable({\n    description: \"Current data table state including all rows, active sort, and active filters\",\n    value: {\n      totalRows: data.length,\n      visibleRows: filteredAndSortedData.length,\n      columns: columns.map((c) => c.key),\n      currentSort: sort,\n      activeFilters,\n      highlightedRows,\n      data: filteredAndSortedData,\n    },\n  });\n\n  // AI action: sort table\n  useCopilotAction({\n    name: \"sortTable\",\n    description: \"Sort the table by a specific column in ascending or descending order\",\n    parameters: [\n      {\n        name: \"columnKey\",\n        type: \"string\",\n        description: `The column to sort by. Available columns: ${columns.map((c) => c.key).join(\", \")}`,\n        required: true,\n      },\n      {\n        name: \"direction\",\n        type: \"string\",\n        description: \"Sort direction: 'asc' for ascending or 'desc' for descending\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <ArrowUpDown className=\"h-4 w-4 animate-spin text-blue-400\" />\n            <span>Sorting table...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-blue-500/30 bg-blue-500/10 px-3 py-2 text-sm text-blue-400\">\n          <ArrowUp className=\"h-4 w-4\" />\n          <span>\n            Sorted by <strong>{args.columnKey}</strong> {args.direction}ending\n          </span>\n        </div>\n      );\n    },\n    handler: ({ columnKey, direction }) => {\n      const validCol = columns.find(c => c.key === columnKey);\n      if (!validCol) return `Column ${columnKey} not found`;\n      setSort({\n        columnKey,\n        direction: direction as \"asc\" | \"desc\",\n      });\n      return `Table sorted by ${columnKey} in ${direction}ending order`;\n    },\n  });\n\n  // AI action: filter table\n  useCopilotAction({\n    name: \"filterTable\",\n    description:\n      \"Filter the table rows by a specific column and value. Use operator to control matching: contains, equals, gt (greater than), lt (less than), gte (>=), lte (<=)\",\n    parameters: [\n      {\n        name: \"columnKey\",\n        type: \"string\",\n        description: `The column to filter by. Available columns: ${columns.map((c) => c.key).join(\", \")}`,\n        required: true,\n      },\n      {\n        name: \"value\",\n        type: \"string\",\n        description: \"The value to filter for\",\n        required: true,\n      },\n      {\n        name: \"operator\",\n        type: \"string\",\n        description: \"The filter operator: contains, equals, gt, lt, gte, lte\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Filter className=\"h-4 w-4 animate-pulse text-purple-400\" />\n            <span>Applying filter...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-purple-500/30 bg-purple-500/10 px-3 py-2 text-sm text-purple-400\">\n          <Filter className=\"h-4 w-4\" />\n          <span>\n            Filtered <strong>{args.columnKey}</strong> {args.operator} &quot;{args.value}&quot;\n          </span>\n        </div>\n      );\n    },\n    handler: ({ columnKey, value, operator }) => {\n      const validCol = columns.find(c => c.key === columnKey);\n      if (!validCol) return `Column ${columnKey} not found`;\n      const newFilter: FilterState = {\n        columnKey,\n        value,\n        operator: operator as FilterState[\"operator\"],\n      };\n      setActiveFilters((prev) => [...prev, newFilter]);\n      return `Filter applied: ${columnKey} ${operator} \"${value}\"`;\n    },\n  });\n\n  // AI action: highlight rows\n  useCopilotAction({\n    name: \"highlightRows\",\n    description:\n      \"Highlight specific rows in the table to draw attention to them. Provide the row indices (0-based) from the currently visible/filtered data.\",\n    parameters: [\n      {\n        name: \"rowIndices\",\n        type: \"number[]\",\n        description: \"Array of row indices (0-based) to highlight\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Sparkles className=\"h-4 w-4 animate-pulse text-amber-400\" />\n            <span>Highlighting rows...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-amber-500/30 bg-amber-500/10 px-3 py-2 text-sm text-amber-400\">\n          <Sparkles className=\"h-4 w-4\" />\n          <span>\n            Highlighted <strong>{args.rowIndices?.length ?? 0}</strong> row(s)\n          </span>\n        </div>\n      );\n    },\n    handler: ({ rowIndices }) => {\n      setHighlightedRows(rowIndices);\n      return `Highlighted ${rowIndices.length} row(s)`;\n    },\n  });\n\n  // AI action: clear filters\n  useCopilotAction({\n    name: \"clearFilters\",\n    description: \"Remove all active filters, sort, and highlighted rows to reset the table to its original state\",\n    parameters: [],\n    handler: () => {\n      setFilters({});\n      setActiveFilters([]);\n      setSort(null);\n      setHighlightedRows([]);\n      return \"All filters, sorting, and highlights cleared\";\n    },\n  });\n\n  const handleSort = (columnKey: string) => {\n    setSort((prev) => {\n      if (prev?.columnKey === columnKey) {\n        if (prev.direction === \"asc\") return { columnKey, direction: \"desc\" };\n        return null;\n      }\n      return { columnKey, direction: \"asc\" };\n    });\n  };\n\n  const handleFilterChange = (columnKey: string, value: string) => {\n    setFilters((prev) => ({ ...prev, [columnKey]: value }));\n  };\n\n  const removeActiveFilter = (index: number) => {\n    setActiveFilters((prev) => prev.filter((_, i) => i !== index));\n  };\n\n  const hasActiveState = activeFilters.length > 0 || sort !== null || highlightedRows.length > 0;\n\n  return (\n    <div className={cn(\"w-full\", className)}>\n      {/* Active filters / sort badges */}\n      {hasActiveState && (\n        <div className=\"mb-3 flex flex-wrap items-center gap-2\">\n          {sort && (\n            <span className=\"inline-flex items-center gap-1.5 rounded-md border border-blue-500/30 bg-blue-500/10 px-2.5 py-1 text-xs text-blue-400\">\n              Sort: {sort.columnKey} {sort.direction === \"asc\" ? \"ascending\" : \"descending\"}\n              <button\n                onClick={() => setSort(null)}\n                className=\"ml-0.5 rounded hover:text-blue-300\"\n              >\n                <X className=\"h-3 w-3\" />\n              </button>\n            </span>\n          )}\n          {activeFilters.map((filter, i) => (\n            <span\n              key={i}\n              className=\"inline-flex items-center gap-1.5 rounded-md border border-purple-500/30 bg-purple-500/10 px-2.5 py-1 text-xs text-purple-400\"\n            >\n              {filter.columnKey} {filter.operator} &quot;{filter.value}&quot;\n              <button\n                onClick={() => removeActiveFilter(i)}\n                className=\"ml-0.5 rounded hover:text-purple-300\"\n              >\n                <X className=\"h-3 w-3\" />\n              </button>\n            </span>\n          ))}\n          {highlightedRows.length > 0 && (\n            <span className=\"inline-flex items-center gap-1.5 rounded-md border border-amber-500/30 bg-amber-500/10 px-2.5 py-1 text-xs text-amber-400\">\n              {highlightedRows.length} row(s) highlighted\n              <button\n                onClick={() => setHighlightedRows([])}\n                className=\"ml-0.5 rounded hover:text-amber-300\"\n              >\n                <X className=\"h-3 w-3\" />\n              </button>\n            </span>\n          )}\n          {hasActiveState && (\n            <button\n              onClick={() => {\n                setFilters({});\n                setActiveFilters([]);\n                setSort(null);\n                setHighlightedRows([]);\n              }}\n              className=\"ml-auto text-xs text-muted-foreground hover:text-foreground transition-colors\"\n            >\n              Clear all\n            </button>\n          )}\n        </div>\n      )}\n\n      {/* Table */}\n      <div className=\"overflow-hidden rounded-lg border border-border/50\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-sm\">\n            {/* Header */}\n            <thead>\n              <tr className=\"border-b border-border/50 bg-muted/30\">\n                {columns.map((col) => (\n                  <th\n                    key={col.key}\n                    scope=\"col\"\n                    aria-sort={col.sortable !== false ? (sort?.columnKey === col.key ? (sort.direction === \"asc\" ? \"ascending\" : \"descending\") : \"none\") : undefined}\n                    className={cn(\n                      \"px-4 py-3 text-left font-medium text-muted-foreground\",\n                      (col.sortable !== false) && \"cursor-pointer select-none hover:text-foreground transition-colors\"\n                    )}\n                    onClick={() => {\n                      if (col.sortable !== false) handleSort(col.key);\n                    }}\n                  >\n                    <div className=\"flex items-center gap-1.5\">\n                      {col.label}\n                      {col.sortable !== false && (\n                        <span className=\"text-muted-foreground/50\">\n                          {sort?.columnKey === col.key ? (\n                            sort.direction === \"asc\" ? (\n                              <ArrowUp className=\"h-3.5 w-3.5 text-blue-400\" />\n                            ) : (\n                              <ArrowDown className=\"h-3.5 w-3.5 text-blue-400\" />\n                            )\n                          ) : (\n                            <ArrowUpDown className=\"h-3.5 w-3.5\" />\n                          )}\n                        </span>\n                      )}\n                    </div>\n                  </th>\n                ))}\n              </tr>\n              {/* Filter row */}\n              <tr className=\"border-b border-border/30 bg-muted/10\">\n                {columns.map((col) => (\n                  <th key={`filter-${col.key}`} scope=\"col\" className=\"px-4 py-2\">\n                    {col.filterable !== false ? (\n                      <div className=\"relative\">\n                        <Search className=\"absolute left-2 top-1/2 h-3 w-3 -translate-y-1/2 text-muted-foreground/50\" />\n                        <input\n                          type=\"text\"\n                          placeholder={`Filter...`}\n                          aria-label={`Filter ${col.label}`}\n                          value={filters[col.key] ?? \"\"}\n                          onChange={(e) =>\n                            handleFilterChange(col.key, e.target.value)\n                          }\n                          className=\"h-7 w-full rounded border border-border/30 bg-background/50 pl-7 pr-2 text-xs font-normal text-foreground placeholder:text-muted-foreground/40 outline-none focus:border-ring focus:ring-1 focus:ring-ring/30 transition-colors\"\n                        />\n                      </div>\n                    ) : (\n                      <div className=\"h-7\" />\n                    )}\n                  </th>\n                ))}\n              </tr>\n            </thead>\n\n            {/* Body */}\n            <tbody>\n              {filteredAndSortedData.length === 0 ? (\n                <tr>\n                  <td\n                    colSpan={columns.length}\n                    className=\"px-4 py-8 text-center text-muted-foreground\"\n                  >\n                    No matching rows found.\n                  </td>\n                </tr>\n              ) : (\n                filteredAndSortedData.map((row, rowIndex) => {\n                  const isHighlighted = highlightedRows.includes(rowIndex);\n                  return (\n                    <tr\n                      key={rowIndex}\n                      className={cn(\n                        \"border-b border-border/20 transition-all duration-300\",\n                        isHighlighted\n                          ? \"bg-amber-500/10 border-amber-500/30 shadow-[inset_0_0_0_1px_rgba(245,158,11,0.2)]\"\n                          : \"hover:bg-muted/20\"\n                      )}\n                    >\n                      {columns.map((col) => (\n                        <td\n                          key={col.key}\n                          className={cn(\n                            \"px-4 py-3\",\n                            isHighlighted && \"text-foreground\"\n                          )}\n                        >\n                          {col.render\n                            ? col.render(row[col.key], row)\n                            : String(row[col.key] ?? \"\")}\n                        </td>\n                      ))}\n                    </tr>\n                  );\n                })\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* Footer */}\n      <div className=\"mt-2 flex items-center justify-between px-1 text-xs text-muted-foreground\">\n        <span>\n          Showing {filteredAndSortedData.length} of {data.length} rows\n        </span>\n        {highlightedRows.length > 0 && (\n          <span className=\"text-amber-400\">\n            {highlightedRows.length} highlighted\n          </span>\n        )}\n      </div>\n      <div aria-live=\"polite\" className=\"sr-only\">\n        Showing {filteredAndSortedData.length} of {data.length} rows{sort ? `, sorted by ${sort.columnKey} ${sort.direction}` : \"\"}\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    }
  ]
}