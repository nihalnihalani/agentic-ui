{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "copilot-calendar",
  "type": "registry:component",
  "title": "CopilotCalendar",
  "description": "Weekly calendar with AI scheduling and event management.",
  "dependencies": [
    "@copilotkit/react-core",
    "lucide-react"
  ],
  "registryDependencies": [],
  "files": [
    {
      "path": "registry/copilot-calendar.tsx",
      "content": "\"use client\";\n\nimport React, { useState, useCallback, useRef } from \"react\";\nimport { useCopilotReadable, useCopilotAction } from \"@copilotkit/react-core\";\nimport { cn } from \"@/lib/utils\";\nimport { Loader2, CheckCircle } from \"lucide-react\";\n\nexport interface CalendarEvent {\n  id: string;\n  title: string;\n  day: string; // \"Mon\" | \"Tue\" | \"Wed\" | \"Thu\" | \"Fri\" | \"Sat\" | \"Sun\"\n  startHour: number; // 8-17\n  endHour: number; // 9-18\n  color: string; // \"violet\" | \"blue\" | \"emerald\" | \"amber\" | \"rose\"\n}\n\ninterface CopilotCalendarProps {\n  initialEvents?: CalendarEvent[];\n  className?: string;\n}\n\nconst DAYS = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"] as const;\nconst HOURS = [8, 9, 10, 11, 12, 13, 14, 15, 16, 17] as const;\n\nconst colorMap: Record<string, { bg: string; border: string; text: string }> = {\n  violet: {\n    bg: \"bg-violet-500/20\",\n    border: \"border-violet-500/30\",\n    text: \"text-violet-300\",\n  },\n  blue: {\n    bg: \"bg-blue-500/20\",\n    border: \"border-blue-500/30\",\n    text: \"text-blue-300\",\n  },\n  emerald: {\n    bg: \"bg-emerald-500/20\",\n    border: \"border-emerald-500/30\",\n    text: \"text-emerald-300\",\n  },\n  amber: {\n    bg: \"bg-amber-500/20\",\n    border: \"border-amber-500/30\",\n    text: \"text-amber-300\",\n  },\n  rose: {\n    bg: \"bg-rose-500/20\",\n    border: \"border-rose-500/30\",\n    text: \"text-rose-300\",\n  },\n};\n\nfunction formatHour(hour: number): string {\n  if (hour === 12) return \"12 PM\";\n  if (hour > 12) return `${hour - 12} PM`;\n  return `${hour} AM`;\n}\n\nconst defaultEvents: CalendarEvent[] = [\n  {\n    id: \"evt-1\",\n    title: \"Team Standup\",\n    day: \"Mon\",\n    startHour: 9,\n    endHour: 10,\n    color: \"violet\",\n  },\n  {\n    id: \"evt-2\",\n    title: \"Design Review\",\n    day: \"Tue\",\n    startHour: 14,\n    endHour: 15,\n    color: \"blue\",\n  },\n  {\n    id: \"evt-3\",\n    title: \"Sprint Planning\",\n    day: \"Wed\",\n    startHour: 10,\n    endHour: 11,\n    color: \"emerald\",\n  },\n  {\n    id: \"evt-4\",\n    title: \"1:1 with Manager\",\n    day: \"Thu\",\n    startHour: 11,\n    endHour: 12,\n    color: \"amber\",\n  },\n  {\n    id: \"evt-5\",\n    title: \"Demo Day\",\n    day: \"Fri\",\n    startHour: 15,\n    endHour: 16,\n    color: \"rose\",\n  },\n];\n\nexport function CopilotCalendar({\n  initialEvents,\n  className,\n}: CopilotCalendarProps) {\n  const [events, setEvents] = useState<CalendarEvent[]>(\n    initialEvents ?? defaultEvents\n  );\n  const [newEventIds, setNewEventIds] = useState<Set<string>>(new Set());\n  const pulseTimeouts = useRef<Map<string, ReturnType<typeof setTimeout>>>(\n    new Map()\n  );\n\n  const triggerPulse = useCallback((eventId: string) => {\n    const existing = pulseTimeouts.current.get(eventId);\n    if (existing) clearTimeout(existing);\n\n    setNewEventIds((prev) => new Set(prev).add(eventId));\n    const timeout = setTimeout(() => {\n      setNewEventIds((prev) => {\n        const next = new Set(prev);\n        next.delete(eventId);\n        return next;\n      });\n      pulseTimeouts.current.delete(eventId);\n    }, 1500);\n    pulseTimeouts.current.set(eventId, timeout);\n  }, []);\n\n  // Expose calendar state to AI\n  useCopilotReadable({\n    description:\n      \"Current weekly calendar state including all events and the visible time range\",\n    value: {\n      totalEvents: events.length,\n      days: DAYS,\n      visibleHours: { start: 8, end: 18 },\n      events: events.map((evt) => ({\n        id: evt.id,\n        title: evt.title,\n        day: evt.day,\n        startHour: evt.startHour,\n        endHour: evt.endHour,\n        color: evt.color,\n      })),\n    },\n  });\n\n  // Action: Add event\n  useCopilotAction({\n    name: \"addEvent\",\n    description:\n      \"Add a new event to the weekly calendar at a specific day and time slot\",\n    parameters: [\n      {\n        name: \"title\",\n        type: \"string\",\n        description: \"The title of the event\",\n        required: true,\n      },\n      {\n        name: \"day\",\n        type: \"string\",\n        description:\n          \"The day of the week: Mon, Tue, Wed, Thu, Fri, Sat, or Sun\",\n        required: true,\n      },\n      {\n        name: \"startHour\",\n        type: \"number\",\n        description: \"The starting hour (8-17, where 8 = 8 AM, 17 = 5 PM)\",\n        required: true,\n      },\n      {\n        name: \"endHour\",\n        type: \"number\",\n        description:\n          \"The ending hour (9-18, where 9 = 9 AM, 18 = 6 PM). Must be greater than startHour\",\n        required: true,\n      },\n      {\n        name: \"color\",\n        type: \"string\",\n        description:\n          'The event color: \"violet\", \"blue\", \"emerald\", \"amber\", or \"rose\"',\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-violet-400\" />\n            <span>Adding event...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-violet-500/30 bg-violet-500/10 px-3 py-2 text-sm text-violet-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>\n            Added <strong>{args.title}</strong> on {args.day}{\" \"}\n            {args.startHour !== undefined && formatHour(args.startHour)}&ndash;\n            {args.endHour !== undefined && formatHour(args.endHour)}\n          </span>\n        </div>\n      );\n    },\n    handler: ({ title, day, startHour, endHour, color }) => {\n      if (!DAYS.includes(day as (typeof DAYS)[number])) {\n        return `Invalid day: ${day}. Must be one of ${DAYS.join(\", \")}`;\n      }\n      if (startHour < 8 || startHour > 17) {\n        return `Invalid startHour: ${startHour}. Must be between 8 and 17`;\n      }\n      if (endHour < 9 || endHour > 18 || endHour <= startHour) {\n        return `Invalid endHour: ${endHour}. Must be between 9 and 18 and greater than startHour`;\n      }\n      const newId = `evt-${Date.now()}-${Math.random().toString(36).slice(2, 7)}`;\n      const newEvent: CalendarEvent = {\n        id: newId,\n        title,\n        day,\n        startHour,\n        endHour,\n        color: color && colorMap[color] ? color : \"blue\",\n      };\n      setEvents((prev) => [...prev, newEvent]);\n      triggerPulse(newId);\n      return `Added \"${title}\" on ${day} from ${formatHour(startHour)} to ${formatHour(endHour)}`;\n    },\n  });\n\n  // Action: Move event\n  useCopilotAction({\n    name: \"moveEvent\",\n    description:\n      \"Move an existing event to a different day and/or time slot on the calendar\",\n    parameters: [\n      {\n        name: \"eventId\",\n        type: \"string\",\n        description: \"The ID of the event to move\",\n        required: true,\n      },\n      {\n        name: \"newDay\",\n        type: \"string\",\n        description:\n          \"The new day of the week: Mon, Tue, Wed, Thu, Fri, Sat, or Sun\",\n      },\n      {\n        name: \"newStartHour\",\n        type: \"number\",\n        description: \"The new starting hour (8-17)\",\n      },\n      {\n        name: \"newEndHour\",\n        type: \"number\",\n        description: \"The new ending hour (9-18)\",\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-blue-400\" />\n            <span>Moving event...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-blue-500/30 bg-blue-500/10 px-3 py-2 text-sm text-blue-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>\n            Moved <strong>{args.eventId}</strong>\n            {args.newDay && (\n              <>\n                {\" \"}\n                &rarr; {args.newDay}\n              </>\n            )}\n            {args.newStartHour !== undefined && (\n              <>\n                {\" \"}\n                at {formatHour(args.newStartHour)}\n              </>\n            )}\n          </span>\n        </div>\n      );\n    },\n    handler: ({ eventId, newDay, newStartHour, newEndHour }) => {\n      let found = false;\n      setEvents((prev) =>\n        prev.map((evt) => {\n          if (evt.id !== eventId) return evt;\n          found = true;\n          return {\n            ...evt,\n            day: newDay ?? evt.day,\n            startHour: newStartHour ?? evt.startHour,\n            endHour: newEndHour ?? evt.endHour,\n          };\n        })\n      );\n      if (!found) return `Event ${eventId} not found`;\n      triggerPulse(eventId);\n      return `Moved event ${eventId}`;\n    },\n  });\n\n  // Action: Remove event\n  useCopilotAction({\n    name: \"removeEvent\",\n    description: \"Remove an event from the calendar by its ID\",\n    parameters: [\n      {\n        name: \"eventId\",\n        type: \"string\",\n        description: \"The ID of the event to remove\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-rose-400\" />\n            <span>Removing event...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-rose-500/30 bg-rose-500/10 px-3 py-2 text-sm text-rose-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>\n            Removed event <strong>{args.eventId}</strong>\n          </span>\n        </div>\n      );\n    },\n    handler: ({ eventId }) => {\n      let found = false;\n      setEvents((prev) =>\n        prev.filter((evt) => {\n          if (evt.id === eventId) {\n            found = true;\n            return false;\n          }\n          return true;\n        })\n      );\n      if (!found) return `Event ${eventId} not found`;\n      return `Removed event ${eventId}`;\n    },\n  });\n\n  // Action: Find free slot\n  useCopilotAction({\n    name: \"findFreeSlot\",\n    description:\n      \"Find the next available free time slot on a given day (or any day) that fits a requested duration\",\n    parameters: [\n      {\n        name: \"day\",\n        type: \"string\",\n        description:\n          \"The preferred day to search. If omitted, searches all days starting from Mon\",\n      },\n      {\n        name: \"durationHours\",\n        type: \"number\",\n        description: \"The required duration in hours (default 1)\",\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-emerald-400\" />\n            <span>Searching for free slot...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-emerald-500/30 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>\n            Found free slot\n            {args.day && (\n              <>\n                {\" \"}\n                on <strong>{args.day}</strong>\n              </>\n            )}\n          </span>\n        </div>\n      );\n    },\n    handler: ({ day, durationHours }) => {\n      const duration = durationHours ?? 1;\n      const daysToSearch = day\n        ? [day]\n        : [...DAYS];\n\n      for (const searchDay of daysToSearch) {\n        const dayEvents = events\n          .filter((evt) => evt.day === searchDay)\n          .sort((a, b) => a.startHour - b.startHour);\n\n        for (let hour = 8; hour <= 18 - duration; hour++) {\n          const slotEnd = hour + duration;\n          const hasConflict = dayEvents.some(\n            (evt) => evt.startHour < slotEnd && evt.endHour > hour\n          );\n          if (!hasConflict) {\n            return `Free slot found: ${searchDay} ${formatHour(hour)}-${formatHour(slotEnd)}`;\n          }\n        }\n      }\n\n      return \"No free slot found matching the criteria\";\n    },\n  });\n\n  // Action: Clear day\n  useCopilotAction({\n    name: \"clearDay\",\n    description: \"Remove all events from a specific day of the week\",\n    parameters: [\n      {\n        name: \"day\",\n        type: \"string\",\n        description:\n          \"The day to clear: Mon, Tue, Wed, Thu, Fri, Sat, or Sun\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-amber-400\" />\n            <span>Clearing day...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-amber-500/30 bg-amber-500/10 px-3 py-2 text-sm text-amber-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>\n            Cleared all events on <strong>{args.day}</strong>\n          </span>\n        </div>\n      );\n    },\n    handler: ({ day }) => {\n      if (!DAYS.includes(day as (typeof DAYS)[number])) {\n        return `Invalid day: ${day}. Must be one of ${DAYS.join(\", \")}`;\n      }\n      const count = events.filter((evt) => evt.day === day).length;\n      setEvents((prev) => prev.filter((evt) => evt.day !== day));\n      return `Cleared ${count} event(s) from ${day}`;\n    },\n  });\n\n  // Helper: get events for a specific day\n  const getEventsForDay = (day: string) =>\n    events.filter((evt) => evt.day === day);\n\n  // Grid dimensions\n  const ROW_HEIGHT = 48; // px per hour row\n\n  return (\n    <div className={cn(\"w-full\", className)}>\n      {/* Calendar grid */}\n      <div className=\"overflow-hidden rounded-lg border border-border/50\">\n        <div className=\"overflow-x-auto\">\n          <div\n            className=\"grid\"\n            style={{\n              gridTemplateColumns: \"64px repeat(7, minmax(120px, 1fr))\",\n            }}\n          >\n            {/* Top-left corner cell */}\n            <div className=\"border-b border-r border-border/30 bg-muted/30 px-2 py-2\" />\n\n            {/* Day headers */}\n            {DAYS.map((day) => (\n              <div\n                key={day}\n                className=\"border-b border-r border-border/30 bg-muted/30 px-3 py-2 text-center text-sm font-semibold text-foreground last:border-r-0\"\n              >\n                {day}\n              </div>\n            ))}\n\n            {/* Hour rows */}\n            {HOURS.map((hour) => (\n              <React.Fragment key={`row-${hour}`}>\n                {/* Hour label */}\n                <div\n                  className=\"border-b border-r border-border/20 bg-muted/10 px-2 py-1 text-right text-xs text-muted-foreground\"\n                  style={{ height: `${ROW_HEIGHT}px` }}\n                >\n                  <span className=\"leading-none\">{formatHour(hour)}</span>\n                </div>\n\n                {/* Day cells for this hour */}\n                {DAYS.map((day) => (\n                  <div\n                    key={`${day}-${hour}`}\n                    className=\"relative border-b border-r border-border/10 last:border-r-0\"\n                    style={{ height: `${ROW_HEIGHT}px` }}\n                  >\n                    {/* Render events that start at this hour */}\n                    {getEventsForDay(day)\n                      .filter((evt) => evt.startHour === hour)\n                      .map((evt) => {\n                        const durationHours = evt.endHour - evt.startHour;\n                        const heightPx = durationHours * ROW_HEIGHT - 4;\n                        const colors = colorMap[evt.color] ?? colorMap.blue;\n                        const isPulsing = newEventIds.has(evt.id);\n\n                        return (\n                          <div\n                            key={evt.id}\n                            className={cn(\n                              \"absolute inset-x-1 top-0.5 z-10 overflow-hidden rounded-md border px-2 py-1 text-xs font-medium transition-all\",\n                              colors.bg,\n                              colors.border,\n                              colors.text,\n                              isPulsing && \"animate-pulse\"\n                            )}\n                            style={{ height: `${heightPx}px` }}\n                            title={`${evt.title} (${formatHour(evt.startHour)}-${formatHour(evt.endHour)})`}\n                          >\n                            <div className=\"truncate leading-tight\">\n                              {evt.title}\n                            </div>\n                            {durationHours > 1 && (\n                              <div className=\"mt-0.5 truncate text-[10px] opacity-70\">\n                                {formatHour(evt.startHour)}&ndash;\n                                {formatHour(evt.endHour)}\n                              </div>\n                            )}\n                          </div>\n                        );\n                      })}\n                  </div>\n                ))}\n              </React.Fragment>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Footer */}\n      <div className=\"mt-2 flex items-center justify-between px-1 text-xs text-muted-foreground\">\n        <span>{events.length} event(s) on calendar</span>\n        <div className=\"flex items-center gap-3\">\n          {Object.entries(colorMap).map(([name, colors]) => (\n            <span\n              key={name}\n              className={cn(\n                \"inline-flex items-center gap-1 capitalize\",\n                colors.text\n              )}\n            >\n              <span\n                className={cn(\"inline-block h-2 w-2 rounded-full\", colors.bg, colors.border, \"border\")}\n              />\n              {name}\n            </span>\n          ))}\n        </div>\n      </div>\n      <div aria-live=\"polite\" className=\"sr-only\">\n        {events.length} events on weekly calendar\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    }
  ]
}