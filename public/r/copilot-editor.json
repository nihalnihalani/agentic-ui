{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "copilot-editor",
  "type": "registry:component",
  "title": "CopilotEditor",
  "description": "Rich text editor with AI writing assistance and formatting.",
  "dependencies": [
    "@copilotkit/react-core",
    "lucide-react"
  ],
  "registryDependencies": [
    "button"
  ],
  "files": [
    {
      "path": "registry/copilot-editor.tsx",
      "content": "\"use client\";\n\nimport { useState, useCallback, useRef, useMemo } from \"react\";\nimport { useCopilotReadable, useCopilotAction } from \"@copilotkit/react-core\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Bold,\n  Italic,\n  Heading,\n  Code,\n  List,\n  Loader2,\n  CheckCircle,\n  Sparkles,\n} from \"lucide-react\";\n\ninterface CopilotEditorProps {\n  initialContent?: string;\n  className?: string;\n}\n\nconst DEFAULT_CONTENT = `# The Future of AI in Software Development\n\nArtificial intelligence is rapidly transforming how we build software. From intelligent code completion to automated testing, AI tools are becoming indispensable companions for developers worldwide.\n\n## AI-Powered Code Generation\n\nModern AI assistants can understand natural language descriptions and translate them into working code. This shift is enabling developers to:\n\n- Focus on architecture and design rather than boilerplate\n- Prototype ideas in minutes instead of hours\n- Reduce common bugs through intelligent suggestions\n- Learn new frameworks and languages faster\n\n## Automated Testing and Quality Assurance\n\nAI is also revolutionizing how we test software. Intelligent systems can now:\n\n- Generate comprehensive test suites from code analysis\n- Identify edge cases that humans often miss\n- Predict which areas of code are most likely to contain bugs\n- Automatically fix simple issues before they reach production\n\n\\`\\`\\`typescript\n// Example: AI-assisted function with auto-generated types\nasync function fetchUserData(userId: string): Promise<User> {\n  const response = await api.get(\\`/users/\\${userId}\\`);\n  return validateUser(response.data);\n}\n\\`\\`\\`\n\nThe future belongs to developers who embrace AI as a collaborative partner, not a replacement. The most productive teams will be those that learn to leverage these tools effectively.\n`;\n\nfunction renderMarkdownToHtml(markdown: string): string {\n  const lines = markdown.split(\"\\n\");\n  const htmlParts: string[] = [];\n  let inCodeBlock = false;\n  let codeBlockContent: string[] = [];\n  let inList = false;\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n\n    // Handle code blocks\n    if (line.trim().startsWith(\"```\")) {\n      if (inCodeBlock) {\n        htmlParts.push(\n          `<pre class=\"rounded-lg bg-muted/30 border border-border/40 p-4 my-3 overflow-x-auto\"><code class=\"text-sm font-mono text-foreground/90\">${codeBlockContent.join(\"\\n\")}</code></pre>`\n        );\n        codeBlockContent = [];\n        inCodeBlock = false;\n      } else {\n        if (inList) {\n          htmlParts.push(\"</ul>\");\n          inList = false;\n        }\n        inCodeBlock = true;\n      }\n      continue;\n    }\n\n    if (inCodeBlock) {\n      codeBlockContent.push(\n        line.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\")\n      );\n      continue;\n    }\n\n    // Handle headings\n    if (line.startsWith(\"### \")) {\n      if (inList) {\n        htmlParts.push(\"</ul>\");\n        inList = false;\n      }\n      const text = applyInlineFormatting(line.slice(4));\n      htmlParts.push(\n        `<h3 class=\"text-base font-semibold text-foreground mt-5 mb-2\">${text}</h3>`\n      );\n      continue;\n    }\n    if (line.startsWith(\"## \")) {\n      if (inList) {\n        htmlParts.push(\"</ul>\");\n        inList = false;\n      }\n      const text = applyInlineFormatting(line.slice(3));\n      htmlParts.push(\n        `<h2 class=\"text-lg font-semibold text-foreground mt-6 mb-2\">${text}</h2>`\n      );\n      continue;\n    }\n    if (line.startsWith(\"# \")) {\n      if (inList) {\n        htmlParts.push(\"</ul>\");\n        inList = false;\n      }\n      const text = applyInlineFormatting(line.slice(2));\n      htmlParts.push(\n        `<h1 class=\"text-2xl font-bold text-foreground mt-6 mb-3\">${text}</h1>`\n      );\n      continue;\n    }\n\n    // Handle list items\n    if (line.startsWith(\"- \")) {\n      if (!inList) {\n        htmlParts.push('<ul class=\"list-disc list-inside space-y-1 my-2 text-sm text-foreground/90\">');\n        inList = true;\n      }\n      const text = applyInlineFormatting(line.slice(2));\n      htmlParts.push(`<li>${text}</li>`);\n      continue;\n    }\n\n    // Close list if we're no longer in one\n    if (inList && !line.startsWith(\"- \")) {\n      htmlParts.push(\"</ul>\");\n      inList = false;\n    }\n\n    // Handle blank lines\n    if (line.trim() === \"\") {\n      htmlParts.push('<div class=\"h-3\"></div>');\n      continue;\n    }\n\n    // Regular paragraph\n    const text = applyInlineFormatting(line);\n    htmlParts.push(\n      `<p class=\"text-sm leading-relaxed text-foreground/90 my-1\">${text}</p>`\n    );\n  }\n\n  // Close any open tags\n  if (inList) {\n    htmlParts.push(\"</ul>\");\n  }\n  if (inCodeBlock && codeBlockContent.length > 0) {\n    htmlParts.push(\n      `<pre class=\"rounded-lg bg-muted/30 border border-border/40 p-4 my-3 overflow-x-auto\"><code class=\"text-sm font-mono text-foreground/90\">${codeBlockContent.join(\"\\n\")}</code></pre>`\n    );\n  }\n\n  return htmlParts.join(\"\\n\");\n}\n\nfunction applyInlineFormatting(text: string): string {\n  // Bold: **text**\n  text = text.replace(/\\*\\*(.+?)\\*\\*/g, \"<strong>$1</strong>\");\n  // Italic: *text*\n  text = text.replace(/\\*(.+?)\\*/g, \"<em>$1</em>\");\n  // Inline code: `text`\n  text = text.replace(\n    /`([^`]+)`/g,\n    '<code class=\"rounded bg-muted/30 px-1.5 py-0.5 text-xs font-mono\">$1</code>'\n  );\n  return text;\n}\n\nexport function CopilotEditor({\n  initialContent,\n  className,\n}: CopilotEditorProps) {\n  const [content, setContent] = useState(initialContent ?? DEFAULT_CONTENT);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  const wordCount = useMemo(\n    () => content.split(/\\s+/).filter(Boolean).length,\n    [content]\n  );\n\n  const lineCount = useMemo(\n    () => content.split(\"\\n\").length,\n    [content]\n  );\n\n  const previewHtml = useMemo(() => renderMarkdownToHtml(content), [content]);\n\n  const insertAtCursorPosition = useCallback(\n    (text: string) => {\n      const textarea = textareaRef.current;\n      if (!textarea) {\n        setContent((prev) => prev + text);\n        return;\n      }\n      const start = textarea.selectionStart;\n      const end = textarea.selectionEnd;\n      const before = content.slice(0, start);\n      const after = content.slice(end);\n      const updated = before + text + after;\n      setContent(updated);\n      requestAnimationFrame(() => {\n        textarea.selectionStart = start + text.length;\n        textarea.selectionEnd = start + text.length;\n        textarea.focus();\n      });\n    },\n    [content]\n  );\n\n  const wrapSelection = useCallback(\n    (wrapper: string) => {\n      const textarea = textareaRef.current;\n      if (!textarea) return;\n      const start = textarea.selectionStart;\n      const end = textarea.selectionEnd;\n      const selected = content.slice(start, end);\n      const wrapped = `${wrapper}${selected || \"text\"}${wrapper}`;\n      const before = content.slice(0, start);\n      const after = content.slice(end);\n      setContent(before + wrapped + after);\n      requestAnimationFrame(() => {\n        textarea.selectionStart = start + wrapper.length;\n        textarea.selectionEnd = start + wrapper.length + (selected || \"text\").length;\n        textarea.focus();\n      });\n    },\n    [content]\n  );\n\n  // Expose document content to AI\n  useCopilotReadable({\n    description:\n      \"Current markdown document content in the editor, including word count and line count\",\n    value: {\n      content,\n      wordCount,\n      lineCount,\n    },\n  });\n\n  // Action: Insert text at cursor position\n  useCopilotAction({\n    name: \"insertAtCursor\",\n    description:\n      \"Insert text at the current cursor position in the markdown editor\",\n    parameters: [\n      {\n        name: \"text\",\n        type: \"string\",\n        description: \"The text to insert at the cursor position\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-blue-400\" />\n            <span>Inserting text...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-blue-500/30 bg-blue-500/10 px-3 py-2 text-sm text-blue-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>\n            Inserted <strong>{(args.text ?? \"\").length}</strong> characters\n          </span>\n        </div>\n      );\n    },\n    handler: ({ text }) => {\n      insertAtCursorPosition(text);\n      return `Inserted text at cursor position`;\n    },\n  });\n\n  // Action: Replace entire content\n  useCopilotAction({\n    name: \"replaceContent\",\n    description:\n      \"Replace the entire content of the markdown editor with new content\",\n    parameters: [\n      {\n        name: \"newContent\",\n        type: \"string\",\n        description: \"The new markdown content to replace the existing content\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-violet-400\" />\n            <span>Replacing content...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-violet-500/30 bg-violet-500/10 px-3 py-2 text-sm text-violet-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>\n            Content replaced ({(args.newContent ?? \"\").split(/\\s+/).filter(Boolean).length} words)\n          </span>\n        </div>\n      );\n    },\n    handler: ({ newContent }) => {\n      setContent(newContent);\n      return \"Content replaced successfully\";\n    },\n  });\n\n  // Action: Format as markdown\n  useCopilotAction({\n    name: \"formatAsMarkdown\",\n    description:\n      \"Clean up and format the current content as properly structured markdown with consistent headings, spacing, and formatting\",\n    parameters: [\n      {\n        name: \"formattedContent\",\n        type: \"string\",\n        description: \"The cleaned-up and properly formatted markdown content\",\n        required: true,\n      },\n    ],\n    render: ({ status }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-emerald-400\" />\n            <span>Formatting markdown...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-emerald-500/30 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>Markdown formatted successfully</span>\n        </div>\n      );\n    },\n    handler: ({ formattedContent }) => {\n      setContent(formattedContent);\n      return \"Content formatted as clean markdown\";\n    },\n  });\n\n  // Action: Improve writing\n  useCopilotAction({\n    name: \"improveWriting\",\n    description:\n      \"Improve the writing quality of the current document by enhancing clarity, grammar, and flow while preserving the original meaning and markdown structure\",\n    parameters: [\n      {\n        name: \"improvedContent\",\n        type: \"string\",\n        description:\n          \"The improved version of the document with better writing quality\",\n        required: true,\n      },\n    ],\n    render: ({ status }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-amber-400\" />\n            <span>Improving writing...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-amber-500/30 bg-amber-500/10 px-3 py-2 text-sm text-amber-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>Writing improved</span>\n        </div>\n      );\n    },\n    handler: ({ improvedContent }) => {\n      setContent(improvedContent);\n      return \"Writing quality improved\";\n    },\n  });\n\n  // Action: Add heading\n  useCopilotAction({\n    name: \"addHeading\",\n    description:\n      \"Add a markdown heading at the end of the document. Supports h1 (#), h2 (##), and h3 (###) levels.\",\n    parameters: [\n      {\n        name: \"text\",\n        type: \"string\",\n        description: \"The heading text\",\n        required: true,\n      },\n      {\n        name: \"level\",\n        type: \"number\",\n        description: \"The heading level: 1 for h1, 2 for h2, 3 for h3\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-purple-400\" />\n            <span>Adding heading...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-purple-500/30 bg-purple-500/10 px-3 py-2 text-sm text-purple-400\">\n          <CheckCircle className=\"h-4 w-4\" />\n          <span>\n            Added h{args.level} heading: <strong>{args.text}</strong>\n          </span>\n        </div>\n      );\n    },\n    handler: ({ text, level }) => {\n      const prefix = \"#\".repeat(Math.min(Math.max(level, 1), 3));\n      const heading = `\\n\\n${prefix} ${text}\\n\\n`;\n      setContent((prev) => prev.trimEnd() + heading);\n      return `Added h${level} heading: ${text}`;\n    },\n  });\n\n  return (\n    <div className={cn(\"flex flex-col gap-3\", className)}>\n      {/* Toolbar */}\n      <div className=\"flex items-center gap-1 rounded-lg border border-border/50 bg-card/50 px-2 py-1.5\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-8 w-8 p-0\"\n          onClick={() => wrapSelection(\"**\")}\n          title=\"Bold\"\n        >\n          <Bold className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-8 w-8 p-0\"\n          onClick={() => wrapSelection(\"*\")}\n          title=\"Italic\"\n        >\n          <Italic className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-8 w-8 p-0\"\n          onClick={() => insertAtCursorPosition(\"\\n## \")}\n          title=\"Heading\"\n        >\n          <Heading className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-8 w-8 p-0\"\n          onClick={() => wrapSelection(\"`\")}\n          title=\"Code\"\n        >\n          <Code className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-8 w-8 p-0\"\n          onClick={() => insertAtCursorPosition(\"\\n- \")}\n          title=\"List\"\n        >\n          <List className=\"h-4 w-4\" />\n        </Button>\n\n        <div className=\"mx-2 h-5 w-px bg-border/50\" />\n\n        <div className=\"flex items-center gap-1.5 px-2 text-xs text-muted-foreground\">\n          <Sparkles className=\"h-3.5 w-3.5 text-violet-400\" />\n          <span>AI actions available</span>\n        </div>\n\n        <div className=\"ml-auto text-xs text-muted-foreground\">\n          {wordCount} words &middot; {lineCount} lines\n        </div>\n      </div>\n\n      {/* Split-pane editor and preview */}\n      <div className=\"grid grid-cols-2 gap-3\" style={{ minHeight: 480 }}>\n        {/* Editor pane */}\n        <div className=\"relative flex overflow-hidden rounded-lg border border-border/50 bg-background/50\">\n          {/* Line number gutter */}\n          <div\n            className=\"flex flex-col items-end border-r border-border/30 bg-muted/20 px-3 py-3 font-mono text-xs leading-[1.625rem] text-muted-foreground/50 select-none\"\n            aria-hidden=\"true\"\n          >\n            {content.split(\"\\n\").map((_, i) => (\n              <span key={i}>{i + 1}</span>\n            ))}\n          </div>\n\n          {/* Textarea */}\n          <textarea\n            ref={textareaRef}\n            value={content}\n            onChange={(e) => setContent(e.target.value)}\n            className=\"flex-1 resize-none bg-transparent p-3 font-mono text-sm leading-[1.625rem] text-foreground placeholder:text-muted-foreground/40 outline-none\"\n            spellCheck={false}\n          />\n        </div>\n\n        {/* Preview pane */}\n        <div className=\"overflow-auto rounded-lg border border-border/50 bg-card/30 p-5\">\n          <div className=\"mb-3 flex items-center gap-2 border-b border-border/30 pb-2 text-xs font-medium text-muted-foreground\">\n            <span>Preview</span>\n          </div>\n          <div\n            className=\"prose-sm\"\n            dangerouslySetInnerHTML={{ __html: previewHtml }}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    }
  ]
}