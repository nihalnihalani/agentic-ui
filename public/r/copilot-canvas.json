{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "copilot-canvas",
  "type": "registry:component",
  "title": "CopilotCanvas",
  "description": "A Kanban board with AI-powered task management and drag-and-drop.",
  "dependencies": [
    "@copilotkit/react-core",
    "lucide-react"
  ],
  "registryDependencies": [
    "badge"
  ],
  "files": [
    {
      "path": "registry/copilot-canvas.tsx",
      "content": "\"use client\";\n\nimport React, { useState, useCallback, useRef } from \"react\";\nimport { useCopilotReadable, useCopilotAction } from \"@copilotkit/react-core\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\nimport { Plus, LayoutGrid, ArrowRight, Loader2 } from \"lucide-react\";\n\nexport interface CanvasItem {\n  id: string;\n  title: string;\n  description?: string;\n  priority?: \"low\" | \"medium\" | \"high\";\n}\n\nexport interface Column {\n  id: string;\n  title: string;\n  items: CanvasItem[];\n}\n\ninterface CopilotCanvasProps {\n  initialColumns: Column[];\n  onUpdate?: (columns: Column[]) => void;\n  className?: string;\n}\n\nconst priorityColors: Record<string, string> = {\n  low: \"bg-emerald-500/20 text-emerald-400 border-emerald-500/30\",\n  medium: \"bg-amber-500/20 text-amber-400 border-amber-500/30\",\n  high: \"bg-red-500/20 text-red-400 border-red-500/30\",\n};\n\nexport function CopilotCanvas({\n  initialColumns,\n  onUpdate,\n  className,\n}: CopilotCanvasProps) {\n  const [columns, setColumns] = useState<Column[]>(initialColumns);\n  const [highlightedItems, setHighlightedItems] = useState<Set<string>>(\n    new Set()\n  );\n  const [draggedItem, setDraggedItem] = useState<{\n    item: CanvasItem;\n    sourceColumnId: string;\n  } | null>(null);\n  const [dragOverColumn, setDragOverColumn] = useState<string | null>(null);\n  const highlightTimeouts = useRef<Map<string, ReturnType<typeof setTimeout>>>(\n    new Map()\n  );\n\n  const updateColumns = useCallback(\n    (updater: (prev: Column[]) => Column[]) => {\n      setColumns((prev) => {\n        const next = updater(prev);\n        onUpdate?.(next);\n        return next;\n      });\n    },\n    [onUpdate]\n  );\n\n  const highlightItem = useCallback((itemId: string) => {\n    const existing = highlightTimeouts.current.get(itemId);\n    if (existing) clearTimeout(existing);\n\n    setHighlightedItems((prev) => new Set(prev).add(itemId));\n    const timeout = setTimeout(() => {\n      setHighlightedItems((prev) => {\n        const next = new Set(prev);\n        next.delete(itemId);\n        return next;\n      });\n      highlightTimeouts.current.delete(itemId);\n    }, 1500);\n    highlightTimeouts.current.set(itemId, timeout);\n  }, []);\n\n  // Expose board state to Copilot\n  useCopilotReadable({\n    description:\n      \"The current state of the kanban board with all columns and their items\",\n    value: columns,\n  });\n\n  // Action: Add item to a column\n  useCopilotAction({\n    name: \"addItem\",\n    description: \"Add a new item/task to a specific column on the board\",\n    parameters: [\n      {\n        name: \"columnId\",\n        type: \"string\",\n        description: \"The ID of the column to add the item to\",\n        required: true,\n      },\n      {\n        name: \"title\",\n        type: \"string\",\n        description: \"The title of the new item\",\n        required: true,\n      },\n      {\n        name: \"description\",\n        type: \"string\",\n        description: \"Optional description for the item\",\n      },\n      {\n        name: \"priority\",\n        type: \"string\",\n        description: 'Priority level: \"low\", \"medium\", or \"high\"',\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-violet-400\" />\n            <span>Adding item...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"rounded-lg border border-violet-500/30 bg-violet-500/10 px-3 py-2 text-sm text-violet-400\">\n          <div className=\"flex items-center gap-2\">\n            <Plus className=\"h-4 w-4\" />\n            <span>\n              Added <strong>{args.title}</strong>\n            </span>\n            {args.priority && (\n              <span className=\"rounded-full border border-violet-500/30 px-1.5 py-0.5 text-[10px] capitalize\">\n                {args.priority}\n              </span>\n            )}\n          </div>\n          {args.description && (\n            <p className=\"mt-1 text-xs text-violet-400/70 truncate\">{args.description}</p>\n          )}\n        </div>\n      );\n    },\n    handler: ({ columnId, title, description, priority }) => {\n      const newId = `item-${Date.now()}-${Math.random().toString(36).slice(2, 7)}`;\n      updateColumns((prev) => {\n        const targetCol = prev.find(col => col.id === columnId);\n        if (!targetCol) return prev;\n        return prev.map((col) =>\n          col.id === columnId\n            ? {\n                ...col,\n                items: [\n                  ...col.items,\n                  {\n                    id: newId,\n                    title,\n                    description,\n                    priority: priority as CanvasItem[\"priority\"],\n                  },\n                ],\n              }\n            : col\n        );\n      });\n      highlightItem(newId);\n    },\n  });\n\n  // Action: Remove item\n  useCopilotAction({\n    name: \"removeItem\",\n    description: \"Remove an item from the board\",\n    parameters: [\n      {\n        name: \"itemId\",\n        type: \"string\",\n        description: \"The ID of the item to remove\",\n        required: true,\n      },\n    ],\n    handler: ({ itemId }) => {\n      updateColumns((prev) =>\n        prev.map((col) => ({\n          ...col,\n          items: col.items.filter((item) => item.id !== itemId),\n        }))\n      );\n    },\n  });\n\n  // Action: Move item between columns\n  useCopilotAction({\n    name: \"moveItem\",\n    description: \"Move an item from its current column to a different column\",\n    parameters: [\n      {\n        name: \"itemId\",\n        type: \"string\",\n        description: \"The ID of the item to move\",\n        required: true,\n      },\n      {\n        name: \"targetColumnId\",\n        type: \"string\",\n        description: \"The ID of the column to move the item to\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-blue-400\" />\n            <span>Moving item...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-blue-500/30 bg-blue-500/10 px-3 py-2 text-sm text-blue-400\">\n          <ArrowRight className=\"h-4 w-4\" />\n          <span>\n            Moved <strong>{args.itemId}</strong> &rarr; <strong>{args.targetColumnId}</strong>\n          </span>\n        </div>\n      );\n    },\n    handler: ({ itemId, targetColumnId }) => {\n      updateColumns((prev) => {\n        const targetCol = prev.find(col => col.id === targetColumnId);\n        if (!targetCol) return prev;\n        let movedItem: CanvasItem | undefined;\n        const withoutItem = prev.map((col) => {\n          const found = col.items.find((item) => item.id === itemId);\n          if (found) movedItem = found;\n          return {\n            ...col,\n            items: col.items.filter((item) => item.id !== itemId),\n          };\n        });\n        if (!movedItem) return prev;\n        return withoutItem.map((col) =>\n          col.id === targetColumnId\n            ? { ...col, items: [...col.items, movedItem!] }\n            : col\n        );\n      });\n      highlightItem(itemId);\n    },\n  });\n\n  // Action: Reorder items within a column\n  useCopilotAction({\n    name: \"reorderItems\",\n    description: \"Reorder items within a column by providing the new order of item IDs\",\n    parameters: [\n      {\n        name: \"columnId\",\n        type: \"string\",\n        description: \"The ID of the column to reorder\",\n        required: true,\n      },\n      {\n        name: \"itemIds\",\n        type: \"string[]\",\n        description: \"Array of item IDs in the desired order\",\n        required: true,\n      },\n    ],\n    handler: ({ columnId, itemIds }) => {\n      updateColumns((prev) =>\n        prev.map((col) => {\n          if (col.id !== columnId) return col;\n          const itemMap = new Map(col.items.map((item) => [item.id, item]));\n          const reordered = (itemIds as string[])\n            .map((id) => itemMap.get(id))\n            .filter(Boolean) as CanvasItem[];\n          return { ...col, items: reordered };\n        })\n      );\n      (itemIds as string[]).forEach((id) => highlightItem(id));\n    },\n  });\n\n  // Action: Add a new column\n  useCopilotAction({\n    name: \"addColumn\",\n    description: \"Add a new column to the board\",\n    parameters: [\n      {\n        name: \"title\",\n        type: \"string\",\n        description: \"The title of the new column\",\n        required: true,\n      },\n    ],\n    render: ({ status, args }) => {\n      if (status === \"inProgress\") {\n        return (\n          <div className=\"flex items-center gap-2 rounded-lg border border-border/50 bg-card/50 px-3 py-2 text-sm\">\n            <Loader2 className=\"h-4 w-4 animate-spin text-emerald-400\" />\n            <span>Adding column...</span>\n          </div>\n        );\n      }\n      return (\n        <div className=\"flex items-center gap-2 rounded-lg border border-emerald-500/30 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-400\">\n          <LayoutGrid className=\"h-4 w-4\" />\n          <span>\n            Added column <strong>{args.title}</strong>\n          </span>\n        </div>\n      );\n    },\n    handler: ({ title }) => {\n      const newId = `col-${Date.now()}-${Math.random().toString(36).slice(2, 7)}`;\n      updateColumns((prev) => [\n        ...prev,\n        { id: newId, title, items: [] },\n      ]);\n    },\n  });\n\n  // Drag handlers\n  const handleDragStart = (item: CanvasItem, sourceColumnId: string) => {\n    setDraggedItem({ item, sourceColumnId });\n  };\n\n  const handleDragOver = (e: React.DragEvent, columnId: string) => {\n    e.preventDefault();\n    setDragOverColumn(columnId);\n  };\n\n  const handleDragLeave = () => {\n    setDragOverColumn(null);\n  };\n\n  const handleDrop = (e: React.DragEvent, targetColumnId: string) => {\n    e.preventDefault();\n    setDragOverColumn(null);\n\n    if (!draggedItem) return;\n    if (draggedItem.sourceColumnId === targetColumnId) {\n      setDraggedItem(null);\n      return;\n    }\n\n    updateColumns((prev) => {\n      const withoutItem = prev.map((col) =>\n        col.id === draggedItem.sourceColumnId\n          ? {\n              ...col,\n              items: col.items.filter((i) => i.id !== draggedItem.item.id),\n            }\n          : col\n      );\n      return withoutItem.map((col) =>\n        col.id === targetColumnId\n          ? { ...col, items: [...col.items, draggedItem.item] }\n          : col\n      );\n    });\n\n    highlightItem(draggedItem.item.id);\n    setDraggedItem(null);\n  };\n\n  const handleDragEnd = () => {\n    setDraggedItem(null);\n    setDragOverColumn(null);\n  };\n\n  return (\n    <div className={cn(\"flex gap-4 overflow-x-auto p-4\", className)}>\n      {columns.map((column) => (\n        <div\n          key={column.id}\n          role=\"group\"\n          aria-label={column.title}\n          className={cn(\n            \"flex w-72 shrink-0 flex-col rounded-xl border border-border/50 bg-card/50 backdrop-blur-sm\",\n            dragOverColumn === column.id && \"border-violet-500/50 bg-violet-500/5\"\n          )}\n          onDragOver={(e) => handleDragOver(e, column.id)}\n          onDragLeave={handleDragLeave}\n          onDrop={(e) => handleDrop(e, column.id)}\n        >\n          {/* Column header */}\n          <div className=\"flex items-center justify-between border-b border-border/30 px-4 py-3\">\n            <h3 className=\"text-sm font-semibold text-foreground\">\n              {column.title}\n            </h3>\n            <span className=\"flex size-5 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground\">\n              {column.items.length}\n            </span>\n          </div>\n\n          {/* Items list */}\n          <div className=\"flex flex-1 flex-col gap-2 p-3\">\n            {column.items.length === 0 && (\n              <div className=\"flex items-center justify-center rounded-lg border border-dashed border-border/40 py-8 text-xs text-muted-foreground\">\n                Drop items here\n              </div>\n            )}\n            {column.items.map((item) => (\n\n              <div\n                key={item.id}\n                draggable\n                onDragStart={() => handleDragStart(item, column.id)}\n                onDragEnd={handleDragEnd}\n                aria-label={`${item.title}${item.priority ? `, ${item.priority} priority` : \"\"}`}\n                className={cn(\n                  \"group cursor-grab rounded-lg border border-border/40 bg-background/80 p-3 transition-all hover:border-border/80 hover:shadow-sm active:cursor-grabbing\",\n                  highlightedItems.has(item.id) &&\n                    \"animate-pulse border-violet-500/60 shadow-[0_0_12px_rgba(139,92,246,0.3)]\",\n                  draggedItem?.item.id === item.id && \"opacity-40\"\n                )}\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <p className=\"text-sm font-medium leading-snug text-foreground\">\n                    {item.title}\n                  </p>\n                  {item.priority && (\n                    <Badge\n                      className={cn(\n                        \"shrink-0 text-[10px] font-medium capitalize\",\n                        priorityColors[item.priority]\n                      )}\n                    >\n                      {item.priority}\n                    </Badge>\n                  )}\n                </div>\n                {item.description && (\n                  <p className=\"mt-1.5 text-xs leading-relaxed text-muted-foreground\">\n                    {item.description}\n                  </p>\n                )}\n                <div className=\"mt-2 flex items-center gap-1.5\">\n                  <span className=\"text-[10px] text-muted-foreground/60 font-mono\">\n                    {item.id.slice(0, 8)}\n                  </span>\n                </div>\n              </div>\n            ))}\n            <button\n              onClick={() => {\n                const title = prompt(\"New item title:\");\n                if (title?.trim()) {\n                  updateColumns(prev => prev.map(col =>\n                    col.id === column.id\n                      ? { ...col, items: [...col.items, { id: `item-${Date.now()}`, title: title.trim(), priority: \"medium\" as const }] }\n                      : col\n                  ));\n                }\n              }}\n              className=\"flex w-full items-center justify-center gap-1 rounded-lg border border-dashed border-border/40 py-2 text-xs text-muted-foreground/60 transition-colors hover:border-border hover:text-muted-foreground\"\n            >\n              <Plus className=\"size-3\" /> Add item\n            </button>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n",
      "type": "registry:component"
    }
  ]
}